# Тестовое задание

## Требования
- docker и docker-compose
- poetry
- python 3.9+

## Первичная настройка сервера
Установить необходимые зависимости и активировать виртуальное окружение
```
poetry install
```
```
poetry shell
```
Запустить контейнер с БД
```
docker-compose up -d
```
Сгенерировать и применить миграции
```
python -m alembic revision --autogenerate
```
```
python -m alembic upgrade heads
```
## Запуск сервера
Запустить контейнер с БД
```
docker-compose up -d
```
Активировать виртуальное окружение
```
poetry shell
```
Запустить сервер
```
python src/main.py
```
## Поставленые задачи
### Действия пользователя
- Регистрация (по паролю и логину, возвращает ссылку активации)

Реализовано с помощью метода POST на эндпонт /users

- Логин

Реализовано с помощью метода POST на эндпоинт /auth

- Просмотр списка товаров

Реализовано с помощью метода GET на эндпоинт /products

- Покупка товара, просто списывает с баланса стоимость товара, при условии наличия на балансе счёта достаточного количества средств
 

Реализовано с помощью метода POST на эндпоинт /products/buy

- Просмотр баланса всех счетов и историю транзакций

Реализовано с помощью метода GET на эндпоинт /users/me. Ответ с этого эндпоинта содердит данные о текущем пользователе, всех его счетах и транзакциях.

- Зачисление средств на счёт, выполняется с помощью эндпоинта [POST] /payment/webhook симулирует начисление со стороннего сервиса.

Реализовано согласно заданию

### Действия администратора

- Видеть все товары
- Создавать/редактировать/удалять товары

Реализовано CRUD View на эндпоинтах /products и /products/\<pk>

- Включать/отключать пользователей

Реализовано методом PUT на эндпоинте /users/\<pk>

- Видеть всех пользователей и их счета

Реализовано методом GET на эндпоинте /users

### Не функциональные критерии

- Логины пользователей уникальны

Реализовано

- После регистрации пользователь создаётся в не активном состоянии. Становится активным переходя по ссылке полученной с регистрации

Реализовано

- Авторизация должна быть сделана через JWT. Защищённые эндпоинты должны получать токен в заголовке Authorization в Bearer формате

Реализовано. Аутентификация доступна с помощью метода POST на эндпоинт /auth

## Особенности
- Openapi документация. Redoc и Swagger доступны по эндпоинтам /docs и /docs/swagger соответвенно;
- В качестве первичного ключа сущностей используется UUID, поэтому доблены доролнительное совейство numericail_id для сущностей, используемых при интеграции с вэбхуком;
- Менеджер миграций alembic.


